#!/bin/bash
# Pre-commit hook for IP compliance checks
# Install: cp .github/hooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

echo "Running IP compliance checks..."

# Check copyright headers
python scripts/legal/add_copyright_headers.py --check
if [ $? -ne 0 ]; then
    echo ""
    echo "ERROR: Some files are missing copyright headers"
    echo "Run: python scripts/legal/add_copyright_headers.py"
    echo ""
    exit 1
fi

echo "Copyright headers verified"

# Check for sensitive files
SENSITIVE_PATTERNS=".env|credentials|\.key$|\.pem$|secret"
STAGED_FILES=$(git diff --cached --name-only)

for file in $STAGED_FILES; do
    if echo "$file" | grep -qE "$SENSITIVE_PATTERNS"; then
        echo ""
        echo "WARNING: Potentially sensitive file staged: $file"
        echo "Please verify this file should be committed."
        echo ""
        read -p "Continue? (y/N) " -n 1 -r
        echo
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            exit 1
        fi
    fi
done

# Check for large files (>10MB)
for file in $STAGED_FILES; do
    if [ -f "$file" ]; then
        size=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file" 2>/dev/null)
        if [ "$size" -gt 10485760 ]; then
            echo ""
            echo "WARNING: Large file staged: $file ($(($size / 1048576))MB)"
            echo "Consider using Git LFS for large files."
            echo ""
        fi
    fi
done

echo "Pre-commit checks passed"
exit 0
