# V5.11 Configuration: Frozen Coverage + Hyperbolic Structure
#
# Key architecture changes from v5.10:
# 1. Encoder is FROZEN (loaded from v5.5, no gradients)
# 2. Only HyperbolicProjection layer trains
# 3. Unified PAdicGeodesicLoss (not separate ranking + radial)
# 4. DifferentiableController with full gradient flow (optional)
#
# Metrics baseline (from v5.5):
# - Coverage: 100% (FROZEN, will not change)
# - 3-adic Correlation: r=0.62 (target: r > 0.8)
# - Radial Hierarchy: r=+0.24 (INVERTED, target: r < -0.3)

# Model Architecture
model:
  name: TernaryVAEV5_11
  latent_dim: 16
  hidden_dim: 64                    # Projection network hidden dim
  max_radius: 0.95                  # Poincare ball radius
  curvature: 1.0                    # Hyperbolic curvature
  use_controller: false             # Start without controller
  use_dual_projection: false        # Single projection for both VAEs

# Frozen Checkpoint
frozen_checkpoint:
  path: sandbox-training/checkpoints/v5_5/latest.pt
  encoder_to_load: both             # Load both encoder_A and encoder_B
  decoder_to_load: decoder_A        # Load decoder_A for verification

# Loss Configuration
loss:
  # Unified Geodesic Loss (THE KEY V5.11 INNOVATION)
  geodesic:
    enabled: true
    curvature: 1.0
    max_target_distance: 3.0        # Target distance for v=0 pairs
    valuation_scale: 3.0            # Exponential decay scale
    n_pairs: 2000                   # Pairs sampled per batch
    use_smooth_l1: true             # Huber loss for robustness

  # Radial Hierarchy Loss (for early training)
  radial:
    enabled: true
    inner_radius: 0.1               # Target for high-valuation (near origin)
    outer_radius: 0.85              # Target for low-valuation (near boundary)
    max_valuation: 9                # log_3(19683)
    valuation_weighting: true       # Weight high-v points more

  # Curriculum blending (radial â†’ geodesic)
  curriculum:
    initial_tau: 0.0                # Start with pure radial focus
    final_tau: 1.0                  # End with pure geodesic focus
    warmup_epochs: 70               # Epochs to reach final_tau

# Training Configuration
training:
  epochs: 100
  batch_size: 512
  lr: 1.0e-3
  weight_decay: 1.0e-4

  # Gradient clipping
  max_grad_norm: 1.0

  # LR Scheduler
  scheduler:
    type: cosine_warmup_restart
    T_0: 20
    T_mult: 2

  # Evaluation frequency
  eval_every: 5
  save_every: 20

# Data Configuration
data:
  # Use full dataset (no train/val split for V5.11 structure training)
  use_full_dataset: true
  n_operations: 19683

# Logging
logging:
  tensorboard: true
  log_dir: runs/v5_11
  print_every: 5

# Checkpoints
checkpoints:
  save_dir: sandbox-training/checkpoints/v5_11
  save_best: true
  best_metric: radial_corr_A        # Lower (more negative) is better
  best_mode: min

# Success Criteria
targets:
  coverage: 1.0                     # 100% (frozen, should not change)
  radial_hierarchy: -0.3            # Target: negative correlation
  distance_correlation: 0.8         # Target: high geodesic correlation

# Option C Configuration (for later testing)
option_c:
  enabled: false
  freeze_encoder_b: false           # If true, only encoder_A frozen
  encoder_b_lr_scale: 0.1           # Lower LR for encoder_B
